<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [['$','$'], ['\\(','\\)']]}});</script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS": {"availableFonts":["TeX"],"scale": 150}});</script>

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

</style>

</head>
<body>
<!-- 
## Styles
<div class="fr-view">
	<style>
		td,
		th,
		tr {
			padding: 8px;
		}
		
		blockquote {
			margin: 10px 0;
			padding: 15px 0;
			border: none !important;
		}
		
		blockquote p {
			box-shadow: 2px 2px 10px grey;
			padding: 15px;
			border-left: 2px solid rgb(57, 11, 192)
		}
		
		img {
			border: 1px solid black;
		}
		
		.code-highlight {
			font-family: "Courier New", monospace;
			font-size: 16px;
			padding-left: 4px;
			color: rgb(217, 0, 0);
		}
		
		.bash {
			background: black;
			color: white;
			font-weight: bold;
			font-family: "Courier New", monospace;
			width: 80%;
			padding: 10px;
		}

	</style>
 -->
<p>‚è∞ Lab time is 20 min | <a href="https://yugabyte.slack.com/archives/C03176Y6BU0">slack feedback</a></p>
<hr>
<h2 id="about-this-lab">About this lab</h2>
<p>In this hands-on lab, you will demonstrate how a Yugabyte Universe handles an availability zone failure. Specifically, how the other nodes in the cluster can auto balance the workload so the impact on the application is minimal.</p>
<h3 id="about-availability-zones">About availability zones</h3>
<p>Availability zones (AZs) are isolated locations within data center regions from which public cloud services originate and operate. Regions are geographic locations in which public cloud service providers' data centers reside.Availability zones are commonly mistaken to equate to a data center. In fact, many availability zones have three or more data centers. However no two availability zones share a data center.</p>
<h2 id="objective">Objective</h2>
<p>As a sales engineer, I want to demonstrate how a Yugabyte Universe handles an availability zone failure with high availability and resiliency.</p>
<h2 id="requirements">Requirements</h2>
<p>Here are the requirements for this lab:</p>
<ul>
<li>A deployed YugabyteDB three node cluster (a Universe) in a multi-zone single region topology running a workload</li>
<li>Yugabyte Platform credentials</li>
</ul>
<h3 id="resources">Resources</h3>
<p>To find how to deploy a Yugabyte Universe on Platform review <strong>LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform</strong>.</p>
<p>To find how to run a sample workload on Yugabyte Platform, review <strong>LAB: Run YB-Sample-Apps from Yugabyte Platform.</strong></p>
<h2 id="simulate-an-az-failure">Simulate an AZ failure</h2>
<p>First, verify that the Yugabyte Universe is running a workload. Go to the EC2 public IP or DNS in the browser. Sign in with your Yugabyte credentials and select the Yugabyte Universe where we will simulate the AZ failure.</p>
<h3 id="verify-universe-workload">Verify Universe workload</h3>
<p>On the Universe Details page, review the <strong>Overview</strong> tab to see that there are currently reads and writes and a table.</p>
<p>Next, select the <strong>Nodes</strong> tab to confirm that all three nodes are healthy, operational, and online. Note that</p>
<p>Notice that each node is located in a different AZ in us-east-1 as shown in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-70/assets/images/healthy_workloads_1600x700.png" alt="Each node is isolated in a separate AZ."></p>
<h2 id="stop-the-processes-on-the-leader">Stop the processes on the leader</h2>
<p>On the <strong>Nodes</strong> tab, select <strong>Actions</strong> drop down list for the node that contains the YB-Master Leader, marked as <strong>(Leader)</strong>.</p>
<blockquote>
<p><strong>Deep Dive:</strong>  For more about <a href="https://docs.yugabyte.com/latest/architecture/core-functions/universe-creation/">the responsibilities of the YB-Master Leader take a look at the Yugabyte Docs.</a></p>
</blockquote>
<p>Next, select <strong>Stop Processes</strong> on the drop down list and confirm by selecting <strong>OK</strong> from the drop down list.</p>
<p>Check the <strong>Tasks</strong> tab to see the progress of the <strong>Node</strong> shutting down its processes.
You can see that the status of the <strong>Stop Node</strong> process is pending.</p>
<p>Within moments, the node will have a status of <strong>Stopped</strong>. Notice that the Raft Consensus has elected a new Leader, while the workload of the stopped node has shifted to the <strong>Live</strong> nodes as shown in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-70/assets/images/two-nodes_1600x700.png" alt="Raft has elected a new leader and the workload for reads and writes has been distributed between the remaining live nodes."></p>
<p>Now that the workload has distributed, check the <strong>Metrics</strong> tab on the Universe details page to see that the Ops/sec for the cluster has been consistent, even with the capacity reduction as shown in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-70/assets/images/2-node-metrics_1600x700.png" alt="Description of this action."></p>
<h3 id="restart-the-node">Restart the node</h3>
<p>To restart the node execute the following instructions:</p>
<ul>
<li>
<p>Navigate to the <strong>Nodes</strong> tab on the Universe details page.</p>
</li>
<li>
<p>Select the <strong>Actions</strong> drop down list of the node that has been stopped.</p>
</li>
<li>
<p>Select <strong>Start Processes</strong>.</p>
</li>
<li>
<p>Select <strong>OK</strong> on the confirmation dialog window.</p>
</li>
<li>
<p>Navigate to the <strong>Tasks</strong> tab to see the Start Node process is pending.</p>
</li>
</ul>
<p>Once this process has finished, notice that the auto load balancer distributes the read and writes to the restarted node once the tablets are ready on the Tablet server.</p>
<h2 id="reflection">Reflection</h2>
<p>The purpose of this lab was to demonstrate how a Yugabyte Universe would handle an availability zone failure. This was accomplished by stopping the processes on a node located in the failed AZ.</p>
<p>A new leader was elected for the Raft group and the workload was successfully distributed between the remaining &quot;live&quot; nodes.</p>
<p>Even though an AZ failed, the remaining nodes were able to auto balance the workload to remain consistent in Ops/sec and Latency metrics.</p>
<p>That's it.</p>
<blockquote>
<p><strong>Important:</strong> Remember to use the Slack link at the top of this lesson to leave your comments. Please note the Section title and name of the lesson.</p>
</blockquote>
<p>Thank you! üòÄ</p>

</body>
</html>
