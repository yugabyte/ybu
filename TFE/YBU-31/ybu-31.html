<style>
  td,
  tr {
    padding: 8px;
  }

  blockquote {
    margin: 0 7px 0 5px;
    padding: 0 16px 0 10px;
  }

  blockquote p {
    box-shadow: 2px 2px 10px grey;
    padding-left: 4px;
    padding: 10px 4px;
  }

  img {
    border: 1px solid black;
  }

  .code-highlight2 {
    font-family: "Courier New", monospace;
    font-size: 16px;
    padding-left: 4px;
    color: rgb(217, 0, 0);
  }

  .bash {
    background: black;
    color: white;
    font-weight: bold;
    font-family: "Courier New", monospace;
    width: auto;
    height: auto;
    padding: 0 10px;
  }
</style>

<h1 id="create-a-yugabyte-multi-zone-universe-using-platform-anywhere">
  Create a Yugabyte Multi-Zone Universe using Platform (Anywhere)
</h1>
<h2 id="introduction">Introduction</h2>
<p>
  In this hands-on deployment lab, you will create a Yugabyte universe that
  consists of a three node cluster in a multi-zone topology. Each node will
  reside in the same region, but in a different availability zone as shown in
  the following diagram:
</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/50-multi_zone_topology_1600x700.png"
    alt="Architecture Diagram of a Multi-zone Three Node Yugabyte universe"
  />
</p>
<p>
  The purpose of a creating a multi-zone topology is to demonstrate Yugabyte
  Platform's ability to provide high availability and workload distribution. The
  added resiliency in a multi-zone topology protects against potential failures
  in case resources in a single availability zone become unavailable. This
  topology can withstand a single zone failure, but not two or more.
</p>
<h3 id="objective">Objective</h3>
<p>
  As an engineer, I want to install Yugabyte Platform on AWS to demonstrate how
  to deploy a three node cluster in a multi-zone topology.
</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>
  Before creating a universe, the cloud provider environment must first be
  configured according to the specifications found in a previous Yugabyte
  Technical Field enablement lab. This is to secure the database as well as
  create access points in the VPC to allow YugabyteDB to connect and communicate
  with the different nodes in the cluster.
</p>
<blockquote>
  <p>
    <strong>Important:</strong> Make a careful note whatever region that
    contains the VPC will be where the EC2 instance will be launched.
  </p>
</blockquote>
<p>In this lab, you will focus on deployment with AWS.</p>
<h2 id="checklist-of-steps-to-install-yugabyte-platform">
  Checklist of Steps to Install Yugabyte Platform
</h2>
<ul>
  <li>
    <p>
      Complete AWS prerequisites (IAM role, access keys, Routing Table entry,
      Security Group, VPC + subnets, Internet Gateway). Details can be found in
      the lab YBU-59.
    </p>
  </li>
  <li>
    <p>
      Obtain the AWS IAM user's access key ID and secret access key. These must
      specifically be enabled for programmatic access so the Yugabyte Platform
      can create the nodes in your region.
      <a
        href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html"
        >For more information about the access key ID and secret access key
        review the AWS docs on AWS credentials.</a
      >
    </p>
  </li>
  <li>
    <p>
      Obtain the Yugabyte Platform license file (.rli) from a Yugabyte
      Representative.
    </p>
  </li>
  <li>
    <p>
      Create an AWS EC2 instance to run the Yugabyte Platform Management
      Console.
    </p>
  </li>
  <li>
    <p>Deploy Yugabyte Platform onto the cloud provider, AWS.</p>
  </li>
  <li>
    <p>Create a YugabyteDB universe using Yugabyte Platform.</p>
  </li>
</ul>
<h3 id="launch-the-ec2">Launch the EC2</h3>
<p>
  Once the VPC, security group, IAM role, subnets, routing table entry, and
  internet gateway have been set up as required in the region us-west-2, you can
  proceed with launching the EC2 instance using an AMI. The EC2 instance will
  perform as the server that will host the Yugabyte Platform Management Console.
</p>
<p>
  To begin, log into the Amazon account and navigate to the EC2 console to
  launch an instance with the following specifications:
</p>
<table>
  <thead>
    <tr>
      <th>Property Type</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Instance Type</td>
      <td>c5.4xlarge</td>
    </tr>
    <tr>
      <td>AMI</td>
      <td>ami-00e87074e52e6c9f9</td>
    </tr>
    <tr>
      <td>OS</td>
      <td>CentOS 7.9.2009 x86_64</td>
    </tr>
    <tr>
      <td>Region</td>
      <td>us-west-2</td>
    </tr>
    <tr>
      <td>Disk Storage</td>
      <td>32GiB, gp3</td>
    </tr>
    <tr>
      <td>Network</td>
      <td>vpc-(Prerequisite-YBU-59)</td>
    </tr>
    <tr>
      <td>Auto-assign Public IP</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>IAM role</td>
      <td>YBU-iamrole-usw1</td>
    </tr>
    <tr>
      <td>Security Group</td>
      <td>(Prerequisite-YBU-59)</td>
    </tr>
    <tr>
      <td>Tags</td>
      <td>
        Name:
        &lt;my-first-four-letters-of-gmail-address&gt;-YBU-platform-dev-us-west-2
      </td>
    </tr>
    <tr>
      <td>Example</td>
      <td>Name: mkim-YBU-platform-dev-us-west-2</td>
    </tr>
    <tr>
      <td>SSH access key</td>
      <td>Generate and save</td>
    </tr>
    <tr>
      <td>Security Key Pair</td>
      <td>ybu-yugaware | RSA - download from course player</td>
    </tr>
  </tbody>
</table>
<p>The following image can be found in the AWS marketplace in most regions:</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/60-ec2-ami_1600x700.png"
    alt="AWS Marketplace has the CentOS 7 AMI."
  />
</p>
<p>
  In this lab, you will use a <code class="code-highlight2">c5.4xlarge</code>, in order to demo
  production level workloads. The specifications of this instance type allow for
  the necessary processing power, 16 cores with 32GiB RAM, that are necessary to
  demonstrate Yugabyte Platform effectively when running production workloads.
</p>
<p>The centOS AMI can be found in the AWS Marketplace.</p>
<blockquote>
  <p>
    <strong>Important:</strong> When creating the EC2 instance, ensure the
    Public IP address setting is ENABLED if it is desired to connect to the EC2
    instance from outside the AWS VPC (eg. from usersâ€™ workstations or
    applications running in Kubernetes environments).
  </p>
</blockquote>
<p>
  The Configure Instance Details page will look similar to the following image:
</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/70-configure_ec2_1600x700.png"
    alt="EC2 configuration details page will have similar values including the IAM role and auto-assignment of the public IP."
  />
</p>
<blockquote>
  <p>
    <strong>Important:</strong> Select &quot;Delete on Termination&quot;, when
    selecting the additional storage for a demo otherwise the EBS volume will
    continue to even after the EC2 instance is terminated.
  </p>
</blockquote>
<p>
  SSH into the EC2 once it is running to configure the environment for the
  Yugabyte Platform Management Console.
</p>
<h2 id="install-yugabyte-platform">Install Yugabyte Platform</h2>
<p>
  In the last step, you launched an EC2 instance using the specification and VPC
  environment required by Yugabyte Platform.
</p>
<p>
  In this step, you will SSH into the EC2 instance and set up the initial
  configuration so that you can install Replicated, a third party tool used to
  verify the Yugabyte license and install Yugabyte Platform.
</p>
<h3 id="setup-the-initial-configuration">Setup the Initial Configuration</h3>
<p>
  Once connected to the EC2 instance by SSH in the CLI, perform the initial
  configuration steps to install the Yugaware platform.
</p>
<ul>
  <li>
    <p>Set the hostname: <code class="code-highlight2"> sudo hostnamectl set-hostname platform</code></p>
  </li>
  <li>
    <p>
      Update the Operating System on the EC2 instance:
      <code class="code-highlight2">sudo yum -y update</code>
    </p>
  </li>
  <li>
    <p>Install <code class="code-highlight2">wget</code>: <code class="code-highlight2">sudo yum install -y wget</code></p>
  </li>
  <li>
    <p>Install <code class="code-highlight2">curl</code>: <code class="code-highlight2">sudo yum install -y curl</code></p>
  </li>
</ul>
<h3 id="install-replicated-on-the-ec2-instance">
  Install Replicated on the EC2 instance
</h3>
<p>
  Once the EC2 instance has been configured and is in the &quot;Running&quot;
  state, you will use Replicated to pull the Yugabyte Platform image once the
  license has been authenticated.
</p>
<p>
  The following Replication script will first install the correct version of
  Docker onto the EC2 instance, then download and run the required Docker
  containers from the Replicated repository.
</p>
<p>
  In order to complete this step, the Platform 2.11 (latest) license file, which
  ends in a <code class="code-highlight2">.rli</code> extension, must be obtained from a Yugabyte
  representative.
</p>
<p>
  Logged in as the user, <code class="code-highlight2">centos</code> (default), runs the following
  command on the EC2 instance to install Replicated and Docker:
</p>
<div class="highlight"><pre><code class="language-bash">curl -sSL https://get.replicated.com/docker | sudo bash
</code></pre></div>
<p>Once the script has run, a series of prompts will appear in the CLI.</p>
<div class="bash">The installer will use service address '&lt;my EC2 public IP address&gt;' (discovered from EC2 metadata service)
The installer has automatically detected the service IP address of this machine as '&lt;my EC2 public IP address&gt;'.
Do you want to:
[0] default: use '&lt;my EC2 public IP address&gt;'
[1] enter new address
Enter desired number (0-1): 0
</div>
<div class="bash">Do you need a proxy to connect to the internet?
No
<p>
  Once these questions have been answered, Replicated and Docker will be
  installed on your EC2 instance.
</p>
<p>
  To verify the installation on your EC2 instance has completed, you will
  receive the following output in your CLI:
</p>
<div class="bash">Operator installation successful
To continue the installation, visit the following URL in your browser:
  http://&lt;my-public-IP&gt;:8800
To create an alias for the replicated CLI command run the following in your current shell or log out and log back in:
  source /etc/replicated.alias
</div></code></pre>
<p>
  The URL in your message will reflect the public IP of your EC2 instance.
  Navigate to this IP at port 8800 to configure, authenticate, and install
  Yugabyte Platform on the EC2 instance.
</p>
<h3 id="upload-the-yugabyte-platform-license-to-install">
  Upload the Yugabyte Platform license to Install
</h3>
<p>
  In the last step, you configured the EC2 instance and installed Replicated. In
  this step, you will pull the Yugabyte Platform image from the Replicated
  registry once the license has been authenticated.
</p>
<p>
  Navigate to the IP address of your EC2 instance at port 8800 in your browser
  to connect to the Replicated console as noted in the proceeding CLI message.
</p>
<p>There you will see the following screen:</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/100-replicated_1600x700.png"
    alt="Yugabyte Platform uses a self-signed SSL/TLS Certificate to secure the communication between your local machine and the Yugabyte Platform Console during setup. You'll see a warning about this in your browser, but you can be confident that this is secure."
  />
</p>
<p>
  Proceed with the Yugabyte Platform installation process with the following
  instructions:
</p>
<ul>
  <li>
    <p>
      Select &quot;Continue to Setup&quot; to begin the installation process.
    </p>
  </li>
  <li>
    <p>
      Next, you will see a warning message regarding a non private connection.
    </p>
  </li>
  <li>
    <p>
      Select &quot;Advanced&quot; and then select &quot;Proceed to &lt;my public
      IP(unsafe)&gt;.
    </p>
  </li>
</ul>
<blockquote>
  <p>
    <strong>Important:</strong> There will not be any security risks in this
    process since you will use a self-signed SSL/TLS Certificate to secure the
    communication between your local machine and the Yugabyte Platform Console.
  </p>
</blockquote>
<ul>
  <li>
    Select &quot;Use the Self-Signed Cert&quot;, on the next page titled
    &quot;HTTPS for admin console&quot; as shown in the following image:
  </li>
</ul>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/150-https_warning_1600x700.png"
    alt="Assign a self-signed certification."
  />
</p>
<ul>
  <li>
    <p>
      On the resulting dialog box, select &quot;Continue without a
      hostname&quot;. Once the internal setup has completed, the next page will
      prompt you to upload the Yugabyte Platform license.
    </p>
  </li>
  <li>
    <p>
      Select &quot;Choose license&quot; to upload the
      <code class="code-highlight2">&lt;my-license&gt;.rli</code> file from your machine as shown in the
      following image:
    </p>
  </li>
</ul>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/160-license_1600x700.png"
    alt="Description of this action."
  />
</p>
<ul>
  <li>
    <p>
      Once uploaded, select &quot;Online&quot; on the next page and select
      &quot;Continue&quot;.
    </p>
  </li>
  <li>
    <p>
      The next page presents a list of Yugabyte Platform versions covered by the
      license. Select the &quot;Latest&quot; version, 2.11, then select
      &quot;Continue with Latest version&quot; as shown in the following page:
    </p>
  </li>
  <li>
    <p>
      On the &quot;Secure the Admin Console&quot; page, create a password. This
      password will log into the Replicated console to retrieve the license
      version and navigate to the Yugabyte Platform console.
    </p>
  </li>
  <li>
    <p>
      The next page progresses through a long list of preflight checks that
      verifies the EC2 instance has the specs to support Yugabyte Platform. The
      preflight checks turn green once verified. Select &quot;Continue&quot; to
      proceed with the Yugabyte Platform configuration.
    </p>
  </li>
  <li>
    <p>
      The next page titled &quot;Settings&quot; will consist the Database
      Config, Application config, and the Metrics config. In the Application
      config, make sure that the field &quot;Hostname&quot; contains the EC2
      instance's IPV4 public IP.
    </p>
  </li>
  <li>
    <p>
      Leave the other fields defaults as-is and select &quot;Save&quot; at the
      bottom of the page.
    </p>
  </li>
  <li>
    <p>
      Select &quot;Restart Now&quot; on the dialog box titled &quot;Settings
      Saved&quot;. This will begin the Yugabyte Platform installation process
      which will take a few moments to complete.
    </p>
  </li>
  <li>
    <p>
      Once the installation process begins, you will be navigated to the
      Replicated dashboard. Here you will see the status of the Yugabyte
      Platform installation. Once the status on the left panel has changed from
      &quot;Starting&quot; to &quot;Started&quot;, select &quot;Open&quot; as
      shown in the following image:
    </p>
  </li>
</ul>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/250-replicated_dashboard_1600x700.png"
    alt="The Replicated dashboard displays the status of the installation and the version number."
  />
</p>
<blockquote>
  <p>
    <strong>Important:</strong> You may receive a Bad Gateway 500 error the
    first time or two you select the &quot;Open&quot; link. Try the link again
    to display the Yugabyte Platform console which has been installed on port 80
    on the EC2 instance. Supported web browsers included Chrome, Firefox, and
    Safari.
  </p>
</blockquote>
<h2 id="add-the-cloud-provider">Add the Cloud Provider</h2>
<p>
  In the last step, you installed Replicated, then used it to install Yugabyte
  Platform onto port 80 on the EC2 instance. In this step, you will register as
  a user with Yugabyte Platform, accept the license agreement, add the cloud
  provider, AWS, and specify the region where the Yugabyte universe will be
  deployed. To complete this step, you will need the AWS access and secrets keys
  to your AWS account to allow Yugabyte Platform to create the AWS
  infrastructure for the three nodes in your cluster.
</p>
<p>
  Once you have navigated to the Yugabyte Platform console you will see the
  following which displays the registration form for the Yugabyte Platform:
</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/200-yugabyte_registration_1600x700.png"
    alt="Yugabyte Platform Admin Console"
  />
</p>
<p>
  Note these credentials since they will be necessary to authenticate into
  Yugabyte Platform.
</p>
<ul>
  <li>
    <p>Select the <code class="code-highlight2">dev</code> Environment for this lab.</p>
  </li>
  <li>
    <p>
      Enter your credentials, check the End User License Agreement, then select
      &quot;Register&quot;.
    </p>
  </li>
  <li>
    <p>
      On the next screen, enter the email and password then select
      &quot;Login&quot;.
    </p>
  </li>
  <li>
    <p>
      Once your credentials have been authenticated, you will be navigated to
      the following screen:
    </p>
  </li>
</ul>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/260-yugabyte_console_1600x700.png"
    alt="The Yugabyte Platform Admin Console"
  />
</p>
<h3 id="configure-the-cloud-provider">Configure the Cloud Provider</h3>
<blockquote>
  <p>
    <strong>Important:</strong> To complete this step, you will need your access
    and secret keys for your EC2 instance.
  </p>
</blockquote>
<p>
  Select the &quot;Configure a Provider&quot; button to add a provider on the
  Cloud Provider form. This page can also be accessed by selecting the
  &quot;Configs&quot; option on the left hand menu panel.
</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/300-cloud_provider_1363x982.png"
    alt="The Cloud Provider Configuration Form"
  />
</p>
<blockquote>
  <p>
    <strong>Important:</strong> Only use lower case characters and hyphens
    &quot;-&quot;.
  </p>
</blockquote>
<p>Fill the proceeding form with the following values:</p>
<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Provider Name</td>
      <td>aws</td>
    </tr>
    <tr>
      <td>Credential Type</td>
      <td>Input Access and Secret keys</td>
    </tr>
    <tr>
      <td>Access Key ID</td>
      <td>&lt;my-aws-account-access-key&gt;</td>
    </tr>
    <tr>
      <td>Secret Access Key</td>
      <td>&lt;my-aws-account-secret-key&gt;</td>
    </tr>
    <tr>
      <td>Keypairs Management</td>
      <td>allow YW to manage key pairs</td>
    </tr>
    <tr>
      <td>SSH Port</td>
      <td>22</td>
    </tr>
    <tr>
      <td>SSH User</td>
      <td>centos</td>
    </tr>
    <tr>
      <td>Enable Hosted Zone</td>
      <td>no</td>
    </tr>
    <tr>
      <td>Air Gap installation</td>
      <td>no</td>
    </tr>
    <tr>
      <td>VPC Setup</td>
      <td>Create a new VPC</td>
    </tr>
    <tr>
      <td>Add region</td>
      <td>us-west-2</td>
    </tr>
  </tbody>
</table>
<p>Select &quot;Add region&quot;, then select &quot;Save&quot;.</p>
<h2 id="create-a-yugabytedb-universe-in-platform">
  Create a YugabyteDB Universe in Platform
</h2>
<p>
  In the last step, the cloud provider was configured and connected to the
  Yugabyte Platform. In this step, you will deploy a multi-zone cluster in the
  selected AWS region.
</p>
<blockquote>
  <p>
    <strong>Important:</strong> The process of creating a universe is
    essentially the same for all provider types, whether it be AWS, GCP, Azure,
    VMware, Red Hat, or On-Prem.
  </p>
</blockquote>
<ul>
  <li>
    <p>
      Select the &quot;Universes&quot; option on the left menu, underneath the
      Dashboard option.
    </p>
  </li>
  <li>
    <p>
      Select &quot;Create Universe&quot; button underneath the profile icon
      located in the top right corner of the universe details page.
    </p>
  </li>
</ul>
<p>This will display the following form:</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/500-create_universe_1276x1146.png"
    alt="Deploy a universe to your cloud provider."
  />
</p>
<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Name</td>
      <td>
        &lt;first four letters in you email address&gt;-ybu-platform-us-west-2
      </td>
    </tr>
    <tr>
      <td>Provider</td>
      <td>aws</td>
    </tr>
    <tr>
      <td>Regions</td>
      <td>US West (Oregon)</td>
    </tr>
    <tr>
      <td>Nodes</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Replication Factor</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Instance Type</td>
      <td>c5.large (2 cores 4GB RAM)</td>
    </tr>
    <tr>
      <td>Assign Public IP</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>Use AWS Time Sync</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>Enable YSQL</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>Enable YSQL Auth</td>
      <td>Disable</td>
    </tr>
    <tr>
      <td>Enable YCQL</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>Enable YCQL Auth</td>
      <td>Disable</td>
    </tr>
    <tr>
      <td>Enable YEDIS</td>
      <td>Disable</td>
    </tr>
    <tr>
      <td>Enable Node-to-Node TLS</td>
      <td>Disable</td>
    </tr>
    <tr>
      <td>Enable Client-to-Node TLS</td>
      <td>Disable</td>
    </tr>
    <tr>
      <td>Enable Encryption at Rest</td>
      <td>Disable</td>
    </tr>
  </tbody>
</table>
<p>
  Select &quot;Create&quot; to deploy the three node cluster into AWS. This
  process will create three EC2 instances in your region in three separate
  availability zones.
</p>
<blockquote>
  <p>
    <strong>Important:</strong> Password authorization has been disabled for the
    databases and encryption to the Nodes for demonstration purposes only to
    facilitate easy access to the databases to demo workloads and benchmarking.
    It is not recommended for production. In order to enable in-transit
    encryption and database password authorization, toggle these values on. Note
    that the default database user is <code class="code-highlight2">yugabyte</code> when accessing the
    databases with the password.
  </p>
</blockquote>
<p>
  Once the process has begun, a progress bar will update the current status of
  the universe being created. After several minutes, the process will complete
  and the status will update to &quot;Ready&quot;. If this hasn't occurred after
  a prolonged amount of time, refresh the page to update the state of the
  universe. The following image verifies that the universe has been successfully
  deployed to AWS:
</p>
<p>
  <img
    src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-31/assets/images/800-deployed_universe_1600x700.png"
    alt="The three node universe has been deployed and is ready for use."
  />
</p>
<h2 id="next-steps">Next Steps</h2>
<p>
  To find out how to run a workload on this universe, review lab YBU-58 for more
  details.
</p>
