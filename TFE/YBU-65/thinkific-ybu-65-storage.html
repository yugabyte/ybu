<style>
  td,
  tr {
    padding: 8px;
  }

  blockquote {
    margin: 0 7px 0 5px;
    padding: 0 16px 0 10px;
    /* border-left: 5px solid; */
    /* font-weight: bold;
    border: 2px 2px 2px 0 solid black;
    color: rgb(217, 0, 0); */
  }

  blockquote p {
    font-weight: bold;
    border: 2px 2px 2px 0 solid black;
    color: rgb(217, 0, 0);
  }

  img {
    border: 2px solid black;
  }

  .code-highlight2 {
    font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New",
      monospace, "Droid Sans Fallback";
    font-size: 14px;
    padding-left: 4px;
    color: rgb(217, 0, 0);
  }

  .bash {
    background: black;
    font: white;
    font-family: Courier, Courier new, Serif;
    width: auto;
    height: auto;
  }
</style>
<div class="fr-view">
  <h1 id="storage-backup-and-restore-on-yugabyte-platform">
    Storage Backup and Restore on Yugabyte Platform
  </h1>

  <h2 id="introduction">Introduction</h2>

  <p>
    In this hands-on lab, you will learn how to create a backup of a database,
    then restore the database using Yugabyte Platform. The ability to backup and
    restore data in a straight forward and simple process is important to
    illustrate Yugabyte&#39;s ability to weather failures, migrations, or other
    outage situations. In this lab, you will backup and restore a YSQL database,
    but understand the process for a YCQL database is nearly identical.
  </p>

  <h3 id="objective">Objective</h3>

  <p>
    As a sales engineer, I will demonstrate how to create a backup of the
    database and restore it.
  </p>

  <h2 id="prerequisites">Prerequisites</h2>

  <ul>
    <li>
      <p>
        A deployed Yugabyte Universe on AWS containing a populated YSQL table.
        For information on how to deploy a Yugabyte Universe on Platform, review
        the previous labs on Universe deployment for a multi-zone cluster.
      </p>
    </li>
    <li>
      <p>
        The workload <code class="code-highlight2">SqlInserts</code> has created
        a table named <code class="code-highlight2">postgresqlkeyvalue</code> in
        the Universe. This workload was downloaded along with Platform as a
        docker container image,
        <code class="code-highlight2">yugabytedb/yb-sample-apps</code>. Details
        on how to run a workload on a Yugabyte Universe can be found in a
        previous lab.
      </p>
    </li>
    <li>
      <p>
        AWS credentials to access the S3 bucket, namely the access key ID and
        the secret access key for the IAM user account.
      </p>
    </li>
    <li>
      <p>
        Yugabyte Platform credentials for the Yugabyte Platform console that is
        installed on the EC2 instance.
      </p>
    </li>
    <li>
      <p>
        The <code class="code-highlight2">.pem</code> key in order to access the
        EC2 instance that contains the Yugabyte Platform console.
      </p>
    </li>
  </ul>

  <blockquote>
    <p>
      <strong>Note:</strong> In this lab, the Universe has been deployed on a
      <code class="code-highlight2">c5.4xlarge</code> EC2 instance using a
      CentOS 7 image.
    </p>
  </blockquote>

  <h2 id="steps-to-create-and-restore-a-database">
    Steps to Create and Restore a Database
  </h2>

  <ul>
    <li>
      <p>Create an S3 bucket that will store the database backup.</p>
    </li>
    <li>
      <p>
        Configure the backup and restore location for the Yugabyte Universe as
        an S3 bucket.
      </p>
    </li>
    <li>
      <p>Backup the database to the S3 bucket.</p>
    </li>
    <li>
      <p>
        Drop the table and verify the Yugabyte Universe no longer contains the
        table.
      </p>
    </li>
    <li>
      <p>Restore the database.</p>
    </li>
    <li>
      <p>
        Verify that the table has been restored in the Yugabyte Universe without
        any data loss.
      </p>
    </li>
  </ul>

  <h2 id="create-the-s3-bucket">Create the S3 bucket</h2>

  <p>
    In this step, you will create an S3 bucket with the proper permissions so
    the Yugabyte Universe can backup and restore the database.
  </p>

  <p>
    Navigate to the S3 console in AWS and select the region that contains the
    Yugabyte Universe. In this lab, it will be
    <code class="code-highlight2">us-west-2</code>.
  </p>

  <p>
    Name the bucket using the first four letters of your email address. For
    example,
    <code class="code-highlight2">mkim-ybu-storage-backup-us-west-2</code>.
  </p>

  <blockquote>
    <p>
      <strong>Important:</strong> Bucket names must be unique in a given region.
    </p>
  </blockquote>

  <p>
    Next, use the default settings listed below and select the &quot;Create
    Bucket&quot; button.
  </p>

  <table>
    <thead>
      <tr>
        <th>Property Name</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>AWS Region</td>
        <td>us-west-2 (Oregon)</td>
      </tr>
      <tr>
        <td>ACLs</td>
        <td>Disabled</td>
      </tr>
      <tr>
        <td>Block all public access</td>
        <td>Enabled</td>
      </tr>
      <tr>
        <td>Bucket Versioning</td>
        <td>Disable</td>
      </tr>
      <tr>
        <td>Default encryption</td>
        <td>Disable</td>
      </tr>
      <tr>
        <td>Object Lock</td>
        <td>Disable</td>
      </tr>
    </tbody>
  </table>
  <br />

  <h3 id="bucket-permissions">Bucket Permissions</h3>

  <p>
    Once the bucket has been created, you will be navigated to the Buckets list.
  </p>

  <p>
    Select the bucket that was just created and view the &quot;Permissions&quot;
    tab.
  </p>

  <p>
    Review the following image to confirm that the user is able to write and
    read the objects that will be created in this bucket:
  </p>

  <p>
    <img
      class="fr-dib fr-fil"
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/026/468/792/1644016854547.jpg"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/026/468/792/1644016854547.jpg?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/026/468/792/1644016854547.jpg?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/026/468/792/1644016854547.jpg?width=1920&dpr=3 3x
      "
    />Note that in the preceding image, you have designated the bucket owner has
    list and write access to the objects in this S3 bucket. This permission is
    setup by default. This will allow the Yugabyte Universe to store and upload
    the database from the S3 bucket.
  </p>

  <p>
    Keep a copy of the bucket name handy since you will need this when
    configuring the backup location for the Yugabyte Universe.
  </p>

  <h2 id="create-a-database-backup">Create a Database Backup</h2>

  <p>
    In the last step, you created an S3 bucket that will store the database
    backup. In this step, you will create a database backup and store it in the
    S3 bucket you just created.
  </p>

  <h3 id="verify-that-the-universe-contains-a-table">
    Verify that the Universe Contains a Table
  </h3>

  <p>
    Navigate to the Yugabyte Platform console on the EC2 instance public IPv4 on
    port 8800 in the browser. Once you have signed in using your credentials,
    you will be navigated to the Universe Dashboard page.
  </p>

  <p>
    Select the Universe that is running the workload,
    <code class="code-highlight2">SqlInserts</code>. For information on how to
    run a sample workload on a Universe, review previous labs for details.
  </p>

  <p>
    Once a Universe is selected, you will be navigated to the Universe details
    page that will present the &quot;Overview&quot; tab by default as shown in
    the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/17e/0d1/cfa/150-universe_overview_1366x768.png"
      style="
        width: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
        max-width: 100%;
        height: auto;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/17e/0d1/cfa/150-universe_overview_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/17e/0d1/cfa/150-universe_overview_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/17e/0d1/cfa/150-universe_overview_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Notice in the preceding image, there is a three node cluster that&#39;s
    running a single YSQL table in the Universe.
  </p>

  <p>
    Selecting the &quot;Tables&quot; tab, we can verify that the
    <code class="code-highlight2">postgresqlkeyvalue</code> table is located in
    the Yugabyte Universe as shown in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/73e/c9a/78d/260-table_1366x768.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/73e/c9a/78d/260-table_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/73e/c9a/78d/260-table_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/73e/c9a/78d/260-table_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Note in the preceding image, the table type is YSQL and the keyspace is
    <code class="code-highlight2">postgres</code>. Keyspace is another term used
    for database, where the table is located.
  </p>

  <p>
    Now that we have verified that the table is currently available in the
    Yugabyte Universe, you will designate the backup location and create a
    backup in the S3 bucket you created earlier.
  </p>

  <h3 id="backup-the-database">Backup the Database</h3>

  <p>
    In the last step, you verified that a YSQL table was available in the
    Yugabyte Universe. In this step, you will designate the backup location then
    store the backup of the database in an S3 bucket.
  </p>

  <h3 id="configure-the-backup-location">Configure the Backup Location</h3>

  <p>
    On the left hand menu of the Yugabyte Platform console, select the
    &quot;Configs&quot; option which will display the following page:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/e14/d71/843/210-cloud_provider_configs_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/e14/d71/843/210-cloud_provider_configs_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/e14/d71/843/210-cloud_provider_configs_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/e14/d71/843/210-cloud_provider_configs_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    On the &quot;Configs&quot; page, select the &quot;Backup&quot; tab. Keep the
    default option for Amazon S3 as shown in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/8ee/8d8/a04/220-create_s3_backup_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/8ee/8d8/a04/220-create_s3_backup_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/8ee/8d8/a04/220-create_s3_backup_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/8ee/8d8/a04/220-create_s3_backup_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    On the preceding page, select the &quot;Create S3 Backup&quot; button. This
    will display the following form:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/33d/379/134/240-backup_config_1366x768.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/33d/379/134/240-backup_config_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/33d/379/134/240-backup_config_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/33d/379/134/240-backup_config_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>Fill out the preceding form with the following values:</p>

  <table>
    <thead>
      <tr>
        <th>Property Name</th>
        <th>Property Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Configuration Name</td>
        <td>ybu-storage-backup-us-west-2</td>
      </tr>
      <tr>
        <td>IAM Role</td>
        <td>Disabled</td>
      </tr>
      <tr>
        <td>Access Key</td>
        <td>&lt;my-access-key&gt;</td>
      </tr>
      <tr>
        <td>Access Secret</td>
        <td>&lt;my-access-secret&gt;</td>
      </tr>
      <tr>
        <td>S3 Bucket</td>
        <td>s3://&lt;email&gt;-ybu-storage-backup-us-west-2</td>
      </tr>
      <tr>
        <td>S3 Bucket Host Base</td>
        <td>s3:amazonaws.com</td>
      </tr>
    </tbody>
  </table>

  <p>Select &quot;Save&quot; to set the S3 bucket as the backup location.</p>

  <p>
    Now that the S3 bucket has been configured in the Universe as the backup
    location, the next step will be to designate the database to backup.
  </p>

  <h3 id="assign-the-database-for-backup">Assign the Database for Backup</h3>

  <p>
    Navigate to the Universes Dashboard page and select the Universe that
    contains the YSQL table you wish to backup.
  </p>

  <p>
    Select the &quot;Backups&quot; tab on the Universe details page to display
    the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/b80/4ac/a3c/300-create_backup_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/b80/4ac/a3c/300-create_backup_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/b80/4ac/a3c/300-create_backup_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/b80/4ac/a3c/300-create_backup_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Select the &quot;Create Backup&quot; button on the preceding page to
    navigate to a form as shown in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/1b2/9eb/cf1/450-create_backup_form_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/1b2/9eb/cf1/450-create_backup_form_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/1b2/9eb/cf1/450-create_backup_form_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/1b2/9eb/cf1/450-create_backup_form_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>In the preceding form, enter the following property values:</p>

  <table>
    <thead>
      <tr>
        <th>Property Name</th>
        <th>Property Value</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Language</td>
        <td>YSQL</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Storage</td>
        <td>S3 Storage</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Namespace</td>
        <td>postgres</td>
        <td>No</td>
      </tr>
      <tr>
        <td>Encrypt Backup</td>
        <td>Disabled</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Parallel Threads</td>
        <td>8</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Number of Days to Retain Backup</td>
        <td>n/a</td>
        <td>Yes</td>
      </tr>
    </tbody>
  </table>

  <p>
    Keep all the default values except the Namespace. This designates the name
    of the database that will be backed up, in this case,
    <code class="code-highlight2">postgres</code>, as we noted in the previous
    step. There is also an option to backup multiple databases if needed.
  </p>

  <blockquote>
    <p>
      <strong>Important:</strong> Several backups can be created that target
      particular databases. Backups can also be set on an automated schedule.
    </p>
  </blockquote>

  <p>
    In a few moments, the backup of the database will complete. Refresh the page
    to update the status of the backup. Once the status is
    &quot;Completed&quot;, you will proceed to the next steps; to drop the table
    and restore it from the backup.
  </p>

  <p>
    To verify the backup was stored in the S3 bucket, go to the S3 console in
    AWS as shown in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/746/515/0a1/800-universe_backup_1366x768.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/746/515/0a1/800-universe_backup_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/746/515/0a1/800-universe_backup_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/746/515/0a1/800-universe_backup_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Now that the backup has been verified, the next step is to drop the table.
    To do this, you will need to connect to the database with the YSQL shell.
    Since the table is distributed on the nodes of the Universe, you will need
    to connect to a node in the cluster first.
  </p>

  <p>
    To get the SSH command to connect to a node, navigate to the
    &quot;Nodes&quot; tab on the Universes details page and select the
    &quot;Actions&quot; drop down located in the Primary Cluster window as shown
    in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/bda/5e3/201/460-node_connect_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/bda/5e3/201/460-node_connect_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/bda/5e3/201/460-node_connect_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/bda/5e3/201/460-node_connect_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>Select &quot;Connect&quot; and copy the command to SSH into this node.</p>
  <div class="highlight">
    <pre><code class="language-bash">sudo ssh -i /opt/yugabyte/yugaware/data/keys/be5f73e4-3bfe-4b55-8c1c-0aa144be10d6/yb-dev-aws_be5f73e4-3bfe-4b55-8c1c-0aa144be10d6-key.pem -ostricthostkeychecking=no -p 22 yugabyte@&lt;node-IP&gt;</code></pre>
  </div>

  <p>
    As can be seen the the preceding statement, the
    <code class="code-highlight2">.pem</code> key for the node instance is
    located on the EC2 instance that contains Yugabyte Platform. This value was
    automatically generated when the Universe was created. You will be accessing
    the node through port 22 with the user name
    <code class="code-highlight2">yugabyte</code>.
  </p>

  <p>Make a note of this command since you will use it to SSH into the node.</p>

  <h2 id="drop-the-table">Drop the Table</h2>

  <p>
    In the last step, you created a backup of the database,
    <code class="code-highlight2">postgres</code>, that contains the table,
    <code class="code-highlight2">postgresqlkeyvalue</code>. In this step, you
    will drop the table, then restore the table from the backup in the S3
    bucket.
  </p>

  <p>
    In this step, you will need the
    <code class="code-highlight2">.pem</code> file to SSH into the EC2 instance.
  </p>

  <p>
    In order to drop the table, you will SSH into the EC2 instance that contains
    the Yugabyte Platform console, connect to a node, then connect to the YSQL
    shell to access the database.
  </p>

  <h3 id="connect-to-the-node">Connect to the Node</h3>

  <p>
    In order to connect to the node, we will first connect to the EC2 instance
    containing the Yugabyte Platform console. In the CLI, execute the following
    command if you <code class="code-highlight2">.pem</code> file is located in
    the <code class="code-highlight2">.ssh</code> directory:
  </p>
  <div class="highlight">
    <pre><code class="language-bash">ssh -i &quot;~/.ssh/ybu-yugaware.pem&quot; centos@&lt;my-EC2-public-IPv4&gt;</code></pre>
  </div>

  <p>
    Once connected to the EC2 instance, paste the SSH command you noted earlier
    to connect to the node that contains the
    <code class="code-highlight2">.pem</code> file for your node. An example of
    this SSH command is shown in the following command:
  </p>
  <div class="highlight">
    <pre><code class="language-bash">sudo ssh -i /opt/yugabyte/yugaware/data/keys/be5f73e4-3bfe-4b55-8c1c-0aa144be10d6/yb-dev-aws_be5f73e4-3bfe-4b55-8c1c-0aa144be10d6-key.pem -ostricthostkeychecking=no -p 22 yugabyte@&lt;node-IP&gt;</code></pre>
  </div>

  <p>
    The verify the connection with the command prompt change to reflect the
    user, <code class="code-highlight2">yugabyte</code>, and the IP address of
    the node. Here is an example of what the connection will look like:
  </p>
  <code class="code-highlight2">[yugabyte@ip-172-151-37-55 ~]$</code>

  <h3 id="connect-to-the-database-with-the-ysql-shell">
    Connect to the Database with the YSQL Shell
  </h3>

  <p>
    In the last step, you connected to the node. In this step you will open the
    YSQL shell in order to connect to the database and drop the table.
  </p>

  <p>Run the following command to connect to the YSQL shell:</p>
  <div class="highlight">
    <pre><code class="language-bash">/home/yugabyte/tserver/bin/ysqlsh -h &lt;my-node-IP&gt; -p 5433 -U yugabyte</code></pre>
  </div>

  <p>
    In the preceding command, you ran the binary file
    <code class="code-highlight2">ysqlsh</code> with the declarations for the
    host, port, and user.
  </p>

  <p>
    Also notice that you are connecting to the
    <code class="code-highlight2">tserver</code> process, which is short for
    tablet server, which is responsible for hosting/serving user data on the
    tables. For more information on how this process relates to the
    <code class="code-highlight2">master</code> process and their relationship
    to the Raft Consensus algorithm to maintain high availability, take a look
    at the
    <a href="https://docs.yugabyte.com/latest/architecture/concepts/universe/"
      >Yugabyte Official documentation on Universe operations.</a
    >
  </p>

  <p>
    You have successfully connected to the YSQL shell if the prompt now looks
    like this:
  </p>
  <code class="highlight">yugabyte=#</code>

  <p>
    Now you can directly connect to the table, view logs, and use PostgreSQL DDL
    or DML statements to make changes to the data layer.
  </p>

  <p>
    First, run the following command to list the databases in the
    <code class="code-highlight2">yugabyte=#</code> command prompt.
  </p>
  <div class="highlight">
    <pre><code class="language-bash">\l</code></pre>
  </div>

  <p>
    This will result in a list of databases in the CLI. We are interested in the
    postgres database that contains the table SqlInserts.
  </p>

  <p>
    In the YSQL shell, connect to the
    <code class="code-highlight2">postgres</code> database with the following
    command:
  </p>
  <div class="highlight">
    <pre><code class="language-bash">\c postgres</code></pre>
  </div>

  <p>The preceding command will return the following result:</p>

  <p>You are now connected to database as user.</p>

  <blockquote>
    <p>
      <strong>Pro Tip:</strong> As a general practice, it is good to turn on the
      <code class="code-highlight2">\timing</code> feature to measure response
      time of the SQL operations.
    </p>
  </blockquote>

  <p>
    To list the tables, run the following command in YSQL shell also known as
    the YSQL shell in the prompt that identifies the database, postgres=#:
  </p>
  <div class="highlight">
    <pre><code class="language-bash">\dt</code></pre>
  </div>

  <p>
    This will display the table, <code>postgresqlkeyvalue</code> in the CLI.
  </p>

  <p>Determine the number of rows in this table with the following command:</p>
  <div class="highlight">
    <pre><code class="language-sql">SELECT count(*) from postgresqlkeyvalue;</code></pre>
  </div>

  <p>This will create the following response in the CLI:</p>

  <div class="bash">
    <p>---------</p>

    <p>2000001</p>

    <p>(1 row)</p>

    <p>Time: 2850.394 ms (00:02.850)</p>
  </div>

  <p>Note, there are 2,000,001 rows in this table.</p>

  <blockquote>
    <p>
      <strong>Deep Dive:</strong>
      <a href="https://docs.yugabyte.com/latest/admin/ysqlsh/"
        >For a closer look at the
        <code class="code-highlight2">ysqlsh</code> and the shell commands,
        visit the official Yugabyte docs for more detailed instructions.</a
      >
    </p>
  </blockquote>

  <p>
    Now that you have established the table is present and populated with data,
    drop this table with the following command:
  </p>
  <div class="highlight">
    <pre><code class="language-sql">DROP TABLE postgresqlkeyvalue;</code></pre>
  </div>

  <p>This command will result in the following response in the CLI:</p>

  <p><code class="language-sql">DROP TABLE Time: 199.763 ms</code></p>

  <h3 id="verify-the-table-has-been-dropped">
    Verify the Table has been Dropped
  </h3>

  <p>
    Now run the <code class="code-highlight2">\dt</code> or
    <code class="code-highlight2"
      >SELECT count(*) from postgresqlkeyvalue;</code
    >
    commands to verify the table is no longer available. The CLI will result in
    the following response:
  </p>

  <p>Did not find any relations</p>

  <p>
    Leave this YSQL shell open so later, you can verify the table has been
    restored.
  </p>

  <p>
    Navigate back to the Yugabyte Platform console in the browser to verify that
    the <code class="code-highlight2">postgresqlkeyvalue</code> table is no
    longer available. Select the &quot;Tables&quot; tab in the Universe Details
    page to see the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/2b3/30e/524/500-drop_table_1366x768.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/2b3/30e/524/500-drop_table_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/2b3/30e/524/500-drop_table_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/2b3/30e/524/500-drop_table_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Note in the preceding image that there are no longer any available tables in
    this Universe.
  </p>

  <h2 id="restore-the-table">Restore the Table</h2>

  <p>
    In the last step, you dropped the table, then verified the table is no
    longer present in the Universe. In this step, you will restore the table and
    verify the data remains consistent with the data prior to the DROP command.
  </p>

  <p>
    On the Yugabyte Platform console, in the Universe details page, select the
    &quot;Backups&quot; tab. Select the &quot;Actions&quot; button for this
    backup and choose the &quot;Restore Backup&quot; option as shown in the
    following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/3ad/e3a/5b8/700-restore_backup_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/3ad/e3a/5b8/700-restore_backup_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/3ad/e3a/5b8/700-restore_backup_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/3ad/e3a/5b8/700-restore_backup_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    By selecting the &quot;Restore Backup&quot; option, a form will appear as
    shown in the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/b72/a47/38c/750-restore_data_1600x700.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/b72/a47/38c/750-restore_data_1600x700.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/b72/a47/38c/750-restore_data_1600x700.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/b72/a47/38c/750-restore_data_1600x700.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    In the preceding form, select the default options for the current Universe
    and the keyspace or database, <code class="code-highlight2">postgres</code>,
    keeping the same number of parallel threads.
  </p>

  <blockquote>
    <p>
      <strong>Pro Tip:</strong> Increasing the parallel thread capacity will
      result in a faster backup or backup restore. This decision depends on the
      size of the backup as well as the resource capacity of the EC2 instances.
    </p>
  </blockquote>

  <p>
    Once the backup restore has completed, check the &quot;Tables&quot; tab in
    the Universes details page to see if the table has been restored as shown in
    the following image:
  </p>

  <p>
    <img
      src="https://files.cdn.thinkific.com/file_uploads/540012/images/ecf/6d3/ae4/260-table_1366x768.png"
      style="
        width: auto;
        max-width: 100%;
        height: auto;
        margin: 5px auto 5px 0px;
        text-align: left;
      "
      class="fr-fic fr-dib fr-fil"
      srcset="
        https://files.cdn.thinkific.com/file_uploads/540012/images/ecf/6d3/ae4/260-table_1366x768.png?width=1920       1x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/ecf/6d3/ae4/260-table_1366x768.png?width=1920&dpr=2 2x,
        https://files.cdn.thinkific.com/file_uploads/540012/images/ecf/6d3/ae4/260-table_1366x768.png?width=1920&dpr=3 3x
      "
    />
  </p>

  <p>
    Note that in the preceding image, the YSQL table has been restored in the
    Universe.
  </p>

  <h3 id="verify-the-table-has-been-restored">
    Verify the Table has been Restored
  </h3>

  <p>
    In the last step, the table was restored. In this step, you will verify the
    data was restored with no data loss.
  </p>

  <p>
    Navigate back to the CLI that is connected to the database via the YSQL
    shell. Run the following command:
  </p>
  <div class="highlight">
    <pre><code class="language-sql">SELECT count(*) from postgresqlkeyvalue;</code></pre>
  </div>

  <p>You will see the following response in the CLI:</p>
  <div class="bash">
    <p>---------</p>

    <p>2000001</p>

    <p>(1 row)</p>
  </div>

  <p>
    From the preceding SQL query response, we have verified that the table has
    been restored and there has been no data loss from the backup and restore
    process.
  </p>

  <h2 id="reflection">Reflection</h2>

  <p>
    In this lab, you created a backup of the YSQL database and restored it. You
    also connected to a YSQL shell on the node to access the database in order
    to remove the table.
  </p>
  <br />
</div>
