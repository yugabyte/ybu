<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [['$','$'], ['\\(','\\)']]}});</script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS": {"availableFonts":["TeX"],"scale": 150}});</script>

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

</style>

</head>
<body>
<h3 id="about-this-lab">About this lab</h3>
<p>In this hands-on lab, you will perform a rolling configuration change of a cluster on Yugabyte Platform. A configuration change is a way to change how the cluster is operating. This could be due to a customer request for better performance or for increased functionality. To accomplish a configuration change, you will update the G-flag on the Tablet Servers in the Yugabyte Platform Admin console by adding a timeout for reads and writes.</p>
<p>A rolling change is a common method to implement a configuration change to a cluster of nodes since there is minimal impact on reliably and performance of the database. The reason the impact is limited is because only one node is updated at a time. This means the load is balanced between the remaining active nodes while the one that's being updated has its workload removed.</p>
<h3 id="objective">Objective</h3>
<p>As a sales engineer, I want to perform a rolling configuration change to my Yugabyte Universe without a noticeable change in the cluster's performance.</p>
<h3 id="requirements">Requirements</h3>
<p>Here are the requirements for this lab:</p>
<ul>
<li>
<p>A deployed YugabyteDB cluster (a Universe)</p>
</li>
<li>
<p>Yugabyte Platform credentials</p>
</li>
<li>
<p>A .pem  file that you can use to connect to the EC2 instance of your YugabyteDB Platform host</p>
</li>
<li>
<p>The Yugabyte Universe must be running a workload.</p>
</li>
</ul>
<h3 id="resources">Resources</h3>
<p>To find how to deploy a Yugabyte Universe on Platform review <strong>LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform</strong>.
To find how to run a sample workload on Yugabyte Platform, review <strong>LAB: Run YB-Sample-Apps from Yugabyte Platform.</strong></p>
<h3 id="edit-configuration-flags">Edit configuration flags</h3>
<p>&quot;Adding and modifying configuration flags for your YB-Master and YB-TServer nodes in a YugabyteDB universe allows you to resolve issues, improve performance, and customize functionality.&quot; ~ <a href="https://docs.yugabyte.com/latest/yugabyte-platform/manage-deployments/edit-config-flags/">Yugabyte Docs</a></p>
<p>In order to edit a configuration flag for a Yugabyte Universe, navigate to the Yugabyte Platform Admin console located at the public IP of your EC2 instance. If created from <code>LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform</code> it will look like the following:</p>
<p><code>ec2-&lt;MY-4-CHAR&gt;-use1-1a-az4-platform</code></p>
<p>Where <code>&lt;MY-4-CHAR&gt;</code> is the four letter name identifier found in your email address.</p>
<p>Once signed in the Yugabyte Platform Admin console, select the YugabyteDB universe that contains the running workload. In this demo, it is running the workloads, <code>SqlInserts</code>, <code>SqlSecondaryIndex</code>, and <code>SqlSnapshotTxns</code> from the repo <code>yb-sample-apps</code>. This is why there are four tables with reads and writes occurring the Universe as seen in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/100-universe_1920x830.png" alt="The Universe is currently running several workloads."></p>
<blockquote>
<p><strong>Troubleshoot:</strong> Having trouble navigating to the Yugabyte Platform Admin console? Make sure the URL address is <code>http</code>, not <code>https</code>.</p>
</blockquote>
<p>Keeping track of the performance is important in order to monitor the universe for performance degradation due to the rolling config change. This could be increases in latency or maxing out the resources on a node.</p>
<h3 id="start-a-rolling-config-change">Start a rolling config change</h3>
<p>Navigate the Universe details page and execute the following steps:</p>
<ul>
<li>Select the <strong>More</strong> drop down located under the profile icon on the top right corner.</li>
</ul>
<blockquote>
<p><strong>Pro-Tip:</strong> If you don't see the <strong>Actions</strong> list, try expanding your window.</p>
</blockquote>
<ul>
<li>
<p>Select <strong>Edit Flags</strong> from the drop down list.</p>
</li>
<li>
<p>In the pop up, Flags, select <strong>Add Flags</strong>.</p>
</li>
<li>
<p>Select <strong>Add as Free text</strong>.</p>
</li>
<li>
<p>Select Add to <strong>T-Server</strong>.</p>
</li>
<li>
<p>Select <strong>Add to T-Server</strong>.</p>
</li>
<li>
<p>Add the following JSON:</p>
<p><code>{ &quot;client_read_write_timeout_ms&quot;: 60000 }</code></p>
</li>
</ul>
<p>This flag sets the timeout for a read or write as 60000ms.</p>
<ul>
<li>
<p>In G-Flags Upgrade Options, select <strong>Rolling</strong>.</p>
</li>
<li>
<p>Select OK.</p>
</li>
</ul>
<h3 id="verify-a-rolling-config-change">Verify a rolling config change</h3>
<p>To verify that the rolling config change is taking place, navigate to the Universe details page and select the <strong>Nodes</strong> tab.</p>
<p>As shown in the following image, one of the nodes is slowly shutting down:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/200-gflag-1-1099x582.png" alt="One of the nodes in the cluster is updating its configuration."></p>
<p>Notice that a few minutes later, once the update has completed and the node has come back online, a different node begins its update as shown in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/300-gflag-2-1083x587.png" alt="Another different node in the cluster is updating its configuration."></p>
<p>In this <strong>rolling</strong> config methodology, only one node goes offline to update while the other nodes balance the remaining load. This is how the universe maintains its performance, resiliency, and availability.</p>
<p>One drawback of this method however is that the update does take longer to implement. If this is the more pressing concern, then the <strong>Non-Rolling</strong> option should be considered. This will update all the nodes at once, but will make the YugabyteDB unavailable, therefore causing downtime.</p>
<p>The third option is <strong>Non-Restart</strong> option which uses in-memory cache.</p>
<h3 id="verify-the-configuration-was-changed">Verify the configuration was changed</h3>
<ul>
<li>
<p>In the Universe details page, select the <strong>Nodes</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Actions</strong> drop down list of the node you wish to connect.</p>
</li>
<li>
<p>Select Connect.</p>
</li>
<li>
<p>Copy the shell script command.</p>
</li>
<li>
<p>SSH into the EC2 instance that is hosting Yugabyte Platform.</p>
</li>
<li>
<p>Execute the shell script command.</p>
</li>
<li>
<p>Display the contents of the <code>server.conf</code> file with the following command: <code>cat /home/yugabyte/tserver/conf/server.conf</code></p>
</li>
</ul>
<p>If the G-Flag update was successful, you will see the timeout as shown in the following image:</p>
<p><img src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/400-timeout_829x706.png" alt="Description of this action."></p>
<p>Nice work, the G-Flag was successfully added to this node.</p>
<h3 id="reflection">Reflection</h3>
<p>In this lab, you implemented a rolling config change to a cluster on Yugabyte Platform. You understand why configuration changes are common and why a rolling config change is better for highly resilient clusters than a non-rolling strategy.</p>

</body>
</html>
