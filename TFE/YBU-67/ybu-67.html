<div class="fr-view">
  <style>
    td,
    th,
    tr {
      padding: 8px;
    }

    blockquote {
      margin: 10px 0;
      padding: 15px 0;
      border: none !important;
    }

    blockquote p {
      box-shadow: 2px 2px 10px grey;
      padding: 15px;
      border-left: 2px solid rgb(57, 11, 192);
    }

    img {
      border: 1px solid black;
    }

    .code-highlight {
      font-family: "Courier New", monospace;
      font-size: 16px;
      padding-left: 4px;
      color: rgb(217, 0, 0);
    }

    .bash {
      background: black;
      color: white;
      font-weight: bold;
      font-family: "Courier New", monospace;
      width: 80%;
      padding: 10px;
    }
  </style>
  <h3 id="about-this-lab">About this lab</h3>
  <p>
    In this hands-on lab, you will perform a rolling configuration change of a
    cluster on Yugabyte Platform. A configuration change is a way to change how
    the cluster is operating. This could be due to a customer request for better
    performance or for increased functionality. To accomplish a configuration
    change, you will update the G-flag on the Tablet Servers in the Yugabyte
    Platform Admin console by adding a timeout for reads and writes.
  </p>
  <p>
    A rolling change is a common method to implement a configuration change to a
    cluster of nodes since there is minimal impact on reliably and performance
    of the database. The reason the impact is limited is because only one node
    is updated at a time. This means the load is balanced between the remaining
    active nodes while the one that's being updated has its workload removed.
  </p>
  <h3 id="objective">Objective</h3>
  <p>
    As a sales engineer, I want to perform a rolling configuration change to my
    Yugabyte Universe without a noticeable change in the cluster's performance.
  </p>
  <h3 id="requirements">Requirements</h3>
  <p>Here are the requirements for this lab:</p>
  <ul>
    <li>
      <p>A deployed YugabyteDB cluster (a Universe)</p>
    </li>
    <li>
      <p>Yugabyte Platform credentials</p>
    </li>
    <li>
      <p>
        A .pem file that you can use to connect to the EC2 instance of your
        YugabyteDB Platform host
      </p>
    </li>
    <li>
      <p>The Yugabyte Universe must be running a workload.</p>
    </li>
  </ul>
  <h3 id="resources">Resources</h3>
  <p>
    To find how to deploy a Yugabyte Universe on Platform review
    <strong
      >LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte
      Platform</strong
    >. To find how to run a sample workload on Yugabyte Platform, review
    <strong>LAB: Run YB-Sample-Apps from Yugabyte Platform.</strong>
  </p>
  <h3 id="edit-configuration-flags">Edit configuration flags</h3>
  <p>
    &quot;Adding and modifying configuration flags for your YB-Master and
    YB-TServer nodes in a YugabyteDB universe allows you to resolve issues,
    improve performance, and customize functionality.&quot; ~
    <a
      href="https://docs.yugabyte.com/latest/yugabyte-platform/manage-deployments/edit-config-flags/"
      >Yugabyte Docs</a
    >
  </p>
  <p>
    In order to edit a configuration flag for a Yugabyte Universe, navigate to
    the Yugabyte Platform Admin console located at the public IP of your EC2
    instance. If created from
    <code
      >LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform</code
    >
    it will look like the following:
  </p>
  <p><code>ec2-&lt;MY-4-CHAR&gt;-use1-1a-az4-platform</code></p>
  <p>
    Where <code>&lt;MY-4-CHAR&gt;</code> is the four letter name identifier
    found in your email address.
  </p>
  <p>
    Once signed in the Yugabyte Platform Admin console, select the YugabyteDB
    universe that contains the running workload. In this demo, it is running the
    workloads, <code>SqlInserts</code>, <code>SqlSecondaryIndex</code>, and
    <code>SqlSnapshotTxns</code> from the repo <code>yb-sample-apps</code>. This
    is why there are four tables with reads and writes occurring the Universe as
    seen in the following image:
  </p>
  <p>
    <img
      src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/100-universe_1920x830.png"
      alt="The Universe is currently running several workloads."
    />
  </p>
  <blockquote>
    <p>
      <strong>Troubleshoot:</strong> Having trouble navigating to the Yugabyte
      Platform Admin console? Make sure the URL address is <code>http</code>,
      not <code>https</code>.
    </p>
  </blockquote>
  <p>
    Keeping track of the performance is important in order to monitor the
    universe for performance degradation due to the rolling config change. This
    could be increases in latency or maxing out the resources on a node.
  </p>
  <h3 id="start-a-rolling-config-change">Start a rolling config change</h3>
  <p>Navigate the Universe details page and execute the following steps:</p>
  <ul>
    <li>
      Select the <strong>More</strong> drop down located under the profile icon
      on the top right corner.
    </li>
  </ul>
  <blockquote>
    <p>
      <strong>Pro-Tip:</strong> If you don't see the
      <strong>Actions</strong> list, try expanding your window.
    </p>
  </blockquote>
  <ul>
    <li>
      <p>Select <strong>Edit Flags</strong> from the drop down list.</p>
    </li>
    <li>
      <p>In the pop up, Flags, select <strong>Add Flags</strong>.</p>
    </li>
    <li>
      <p>Select <strong>Add as Free text</strong>.</p>
    </li>
    <li>
      <p>Select Add to <strong>T-Server</strong>.</p>
    </li>
    <li>
      <p>Select <strong>Add to T-Server</strong>.</p>
    </li>
    <li>
      <p>Add the following JSON:</p>
      <p><code>{ &quot;client_read_write_timeout_ms&quot;: 60000 }</code></p>
    </li>
  </ul>
  <p>This flag sets the timeout for a read or write as 60000ms.</p>
  <ul>
    <li>
      <p>In G-Flags Upgrade Options, select <strong>Rolling</strong>.</p>
    </li>
    <li>
      <p>Select OK.</p>
    </li>
  </ul>
  <h3 id="verify-a-rolling-config-change">Verify a rolling config change</h3>
  <p>
    To verify that the rolling config change is taking place, navigate to the
    Universe details page and select the <strong>Nodes</strong> tab.
  </p>
  <p>
    As shown in the following image, one of the nodes is slowly shutting down:
  </p>
  <p>
    <img
      src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/200-gflag-1-1099x582.png"
      alt="One of the nodes in the cluster is updating its configuration."
    />
  </p>
  <p>
    Notice that a few minutes later, once the update has completed and the node
    has come back online, a different node begins its update as shown in the
    following image:
  </p>
  <p>
    <img
      src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/300-gflag-2-1083x587.png"
      alt="Another different node in the cluster is updating its configuration."
    />
  </p>
  <p>
    In this <strong>rolling</strong> config methodology, only one node goes
    offline to update while the other nodes balance the remaining load. This is
    how the universe maintains its performance, resiliency, and availability.
  </p>
  <p>
    One drawback of this method however is that the update does take longer to
    implement. If this is the more pressing concern, then the
    <strong>Non-Rolling</strong> option should be considered. This will update
    all the nodes at once, but will make the YugabyteDB unavailable, therefore
    causing downtime.
  </p>
  <p>
    The third option is <strong>Non-Restart</strong> option which uses in-memory
    cache.
  </p>
  <h3 id="verify-the-configuration-was-changed">
    Verify the configuration was changed
  </h3>
  <ul>
    <li>
      <p>
        In the Universe details page, select the <strong>Nodes</strong> tab.
      </p>
    </li>
    <li>
      <p>
        Select the <strong>Actions</strong> drop down list of the node you wish
        to connect.
      </p>
    </li>
    <li>
      <p>Select Connect.</p>
    </li>
    <li>
      <p>Copy the shell script command.</p>
    </li>
    <li>
      <p>SSH into the EC2 instance that is hosting Yugabyte Platform.</p>
    </li>
    <li>
      <p>Execute the shell script command.</p>
    </li>
    <li>
      <p>
        Display the contents of the <code>server.conf</code> file with the
        following command:
        <code>cat /home/yugabyte/tserver/conf/server.conf</code>
      </p>
    </li>
  </ul>
  <p>
    If the G-Flag update was successful, you will see the timeout as shown in
    the following image:
  </p>
  <p>
    <img
      src="file:///Users/markkim/Documents/YBU_repos/YBU_public/TFE/YBU-67/assets/images/400-timeout_829x706.png"
      alt="Description of this action."
    />
  </p>
  <p>Nice work, the G-Flag was successfully added to this node.</p>
  <h3 id="reflection">Reflection</h3>
  <p>
    In this lab, you implemented a rolling config change to a cluster on
    Yugabyte Platform. You understand why configuration changes are common and
    why a rolling config change is better for highly resilient clusters than a
    non-rolling strategy.
  </p>
</div>