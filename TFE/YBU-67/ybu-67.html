<div class="fr-view">
	<style>
		td,
		th,
		tr {
			padding: 8px;
		}
		
		blockquote {
			margin: 10px 0;
			padding: 15px 0;
			border: none !important;
		}
		
		blockquote p {
			box-shadow: 2px 2px 10px grey;
			padding: 15px;
			border-left: 2px solid rgb(57, 11, 192);
		}
		
		img {
			border: 1px solid black;
		}
		
		.code-highlight {
			font-family: "Courier New", monospace;
			font-size: 16px;
			padding-left: 4px;
			color: rgb(217, 0, 0);
		}
		
		.bash {
			background: black;
			color: white;
			font-weight: bold;
			font-family: "Courier New", monospace;
			width: 80%;
			padding: 10px;
		}

	</style>

	<h3 id="about-this-lab">About this lab</h3>

	<p>In this hands-on lab, you will perform a rolling configuration change of a cluster on Yugabyte Platform. You can relate this to fine tuning an instrument to be more performant or less resource hungry. To accomplish a configuration change, you will update the G-flag on the Tablet Servers in the Yugabyte Platform Admin console by adding a timeout for reads and writes.</p>

	<p>A rolling change is a common method to implement a configuration change to a cluster of nodes since there is minimal downtime. More on this method as well as the other options will be explained in this lesson.</p>

	<h3 id="objective">Objective</h3>

	<p>As a sales engineer, I want to perform a rolling configuration change to my Yugabyte Universe without a noticeable change in the cluster&#39;s performance.</p>

	<h3 id="requirements">Requirements</h3>

	<p>Here are the requirements for this lab:</p>

	<ul>
		<li>

			<p>A deployed YugabyteDB cluster (a Universe)</p>
		</li>
		<li>

			<p>Yugabyte Platform credentials</p>
		</li>
		<li>

			<p>The associated <strong>.pem</strong> file to connect to the EC2 instance of your YugabyteDB Platform host.</p>
		</li>
		<li>

			<p>The Yugabyte Universe must be running a workload.</p>
		</li>
	</ul>

	<h3 id="resources">Resources</h3>

	<p>To find how to deploy a Yugabyte Universe on Platform review <strong>LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform</strong>.&nbsp;</p>

	<p>To find how to run a sample workload on Yugabyte Platform, review <strong>LAB: Run YB-Sample-Apps from Yugabyte Platform.</strong></p>

	<h3 id="edit-configuration-flags">Edit configuration flags</h3>

	<p>&quot;Adding and modifying configuration flags for your YB-Master and YB-TServer nodes in a YugabyteDB universe allows you to resolve issues, improve performance, and customize functionality.&quot; ~ <a href="https://docs.yugabyte.com/latest/yugabyte-platform/manage-deployments/edit-config-flags/">Yugabyte Docs</a></p>

	<p>In order to edit a configuration flag for a Yugabyte Universe, navigate to the Yugabyte Platform Admin console located at the public IP of your EC2 instance. If created from <strong>LAB: Create a Yugabyte Multi-Zone Universe using Yugabyte Platform,</strong> it will look like the following:</p>

	<p><code><strong>ec2-&lt;MY-4-CHAR&gt;-use1-1a-az4-platform</strong></code></p>

	<p>Where <code><strong>&lt;MY-4-CHAR&gt;</strong></code> is the first four letters in your email address.</p>

	<p>Once signed in the Yugabyte Platform Admin console, select the YugabyteDB universe that contains the running workload. In this demo, it is running the workloads, <code>SqlInserts</code>, <code>SqlSecondaryIndex</code>, and <code>SqlSnapshotTxns</code> from the repo <code>yb-sample-apps</code>. Verify there are four tables with reads and writes occurring in the Universe as seen in the following image:</p>

	<p><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/8a5/621/40f/100-universe_1920x830.png" style="width: 840px; max-width: 100%; height: 365.586px;" class="fr-fic fr-dib" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/8a5/621/40f/100-universe_1920x830.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/8a5/621/40f/100-universe_1920x830.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/8a5/621/40f/100-universe_1920x830.png?width=1920&dpr=3 3x"></p>

	<blockquote>

		<p><strong>Troubleshoot:</strong> Having trouble navigating to the Yugabyte Platform Admin console? Make sure the URL address is <code>http</code>, not <code>https</code>.</p>
	</blockquote>

	<p>Keeping track of the performance is important in order to monitor the universe for performance degradation due to the rolling config change. This could be increases in latency or maxing out the resources on a node.</p>

	<h3 id="start-a-rolling-config-change">Start a rolling config change</h3>

	<p>Navigate the Universe details page and execute the following steps:</p>

	<ul>
		<li>Select the <strong>More</strong> drop down located under the profile icon on the top right corner.</li>
	</ul>

	<blockquote>

		<p><strong>Pro-Tip:</strong> If you don&#39;t see the <strong>Actions</strong> list, try expanding your window.</p>
	</blockquote>

	<ul>
		<li>

			<p>Select <strong>Edit Flags</strong> from the drop down list.</p>
		</li>
		<li>

			<p>In the pop up, Flags, select <strong>Add Flags</strong>.</p>
		</li>
		<li>

			<p>Select <strong>Add as Free text</strong>.</p>
		</li>
		<li>

			<p>Select <strong>Add to</strong> <strong>T-Server</strong>.</p>
		</li>
		<li>

			<p>Add the following JSON:</p>

			<p><code>{ &quot;client_read_write_timeout_ms&quot;: 60000 }</code></p>
		</li>
	</ul>

	<p>This flag sets the timeout for a read or write as 60000ms.</p>

	<ul>
		<li>

			<p>In G-Flags Upgrade Options, select <strong>Rolling</strong>.</p>
		</li>
		<li>

			<p>Select OK.</p>
		</li>
	</ul>

	<p>This will begin the rolling config update process.</p>

	<p>For more information on the many types of config flags available for the Tablet and Master servers, take a look at the <a href="https://docs.yugabyte.com/latest/reference/configuration/" rel="noopener noreferrer" target="_blank">Yugabyte docs.</a></p>

	<h3 id="verify-a-rolling-config-change">Verify a rolling config change</h3>

	<p>To verify that the rolling config change process has started, navigate to the Universe details page and select the <strong>Nodes</strong> tab.</p>

	<p>As shown in the following image, one of the nodes has went offline:</p>

	<p><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/ccb/f2a/260/YBU_CurrDev_Template_1600_x_700_%282%29.png" style="width: 840px; max-width: 100%; height: 365.586px;" class="fr-fic fr-dib" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/ccb/f2a/260/YBU_CurrDev_Template_1600_x_700_%282%29.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/ccb/f2a/260/YBU_CurrDev_Template_1600_x_700_%282%29.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/ccb/f2a/260/YBU_CurrDev_Template_1600_x_700_%282%29.png?width=1920&dpr=3 3x"></p>

	<p>Notice that a few minutes later, once the update has completed and the node has come back online. Now a second node begins its update as shown in the following image:</p>

	<p><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/a8b/ac5/7aa/YBU_CurrDev_Template_1600_x_700_%283%29.png" style="width: 841px; max-width: 100%; height: 366.022px;" class="fr-fic fr-dib" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/a8b/ac5/7aa/YBU_CurrDev_Template_1600_x_700_%283%29.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/a8b/ac5/7aa/YBU_CurrDev_Template_1600_x_700_%283%29.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/a8b/ac5/7aa/YBU_CurrDev_Template_1600_x_700_%283%29.png?width=1920&dpr=3 3x"></p>

	<p>Wait a few minutes longer and you will see the third node went offline as the the second node returns online once the config change has completed. Notice that the read and write operations have increased on the online nodes as the offline node&#39;s operations decrease to zero. The workload is being balanced to accommodate for the decrease in resources.
		<br>
		<br>In this <strong>rolling</strong> config methodology, only one node goes offline at a time while the other nodes balance the remaining load. This is how the universe maintains its performance, resiliency, and availability.</p>

	<p>One drawback of this method however is that the update takes longer to implement. If updating was the more pressing concern than downtime, then the <strong>Non-Rolling</strong> option could be considered. This will update all the nodes at once, but will make the app unavailable.</p>

	<p>The third option is <strong>Non-Restart&nbsp;</strong>which is used for in-memory settings. This also doesn&#39;t cause downtime for app.</p>

	<p>Review the metrics before and during the rolling config change to see if the number of Ops/Sec or latency are impacted.
		<br>
		<br>Before:</p>

	<p><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/48c/a5f/cfb/400-metrics_before_1366x768.png" style="width: auto; max-width: 100%; height: auto;" class="fr-fic fr-dib" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/48c/a5f/cfb/400-metrics_before_1366x768.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/48c/a5f/cfb/400-metrics_before_1366x768.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/48c/a5f/cfb/400-metrics_before_1366x768.png?width=1920&dpr=3 3x"></p>

	<p>During the rolling config change:</p>

	<h3><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/622/dba/821/600-during_config_1366x768.png" style="width: auto; max-width: 100%; height: auto; margin: 5px auto 5px 0px; text-align: left;" class="fr-fic fr-dib fr-fil" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/622/dba/821/600-during_config_1366x768.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/622/dba/821/600-during_config_1366x768.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/622/dba/821/600-during_config_1366x768.png?width=1920&dpr=3 3x"></h3>

	<p>In the timeline, the workload began shortly before 9:00, then the rolling change began at 9:11 and ended at 9:21. Although the reads coming from the sample app ended at 9:15, the writes continued.
		<br>The nodes were successfully able to balance the workload as the config updates rolled through the cluster.</p>

	<h3 id="verify-the-configuration-was-changed">Verify the configuration flag was added</h3>

	<p>Although the process has completed, how do we know that the G-Flag was actually added?
		<br>We can SSH into a node and check the T-Server config file.&nbsp;</p>

	<ul>
		<li>

			<p>In the Universe details page, select the <strong>Nodes</strong> tab.</p>
		</li>
		<li>

			<p>Select the <strong>Actions</strong> drop down list of the node you wish to connect.</p>
		</li>
		<li>

			<p>Select Connect.</p>
		</li>
		<li>

			<p>Copy the shell script command. (This contains the autogeneration .pem file)</p>
		</li>
		<li>

			<p>SSH into the EC2 instance that is hosting Yugabyte Platform.</p>
		</li>
		<li>

			<p>Execute the shell script command.</p>
		</li>
		<li>

			<p>Display the contents of the <code>server.conf</code> file with the following command: <code>cat /home/yugabyte/tserver/conf/server.conf</code></p>
		</li>
	</ul>

	<p>If the G-Flag update was successful, you will see the timeout as shown in the following image:</p>

	<p><img src="https://files.cdn.thinkific.com/file_uploads/540012/images/59c/6b0/7c5/YBU_CurrDev_Template_1600_x_700.png" style="width: 845px; max-width: 100%; height: 367.767px;" class="fr-fic fr-dib" srcset="https://files.cdn.thinkific.com/file_uploads/540012/images/59c/6b0/7c5/YBU_CurrDev_Template_1600_x_700.png?width=1920 1x, https://files.cdn.thinkific.com/file_uploads/540012/images/59c/6b0/7c5/YBU_CurrDev_Template_1600_x_700.png?width=1920&dpr=2 2x, https://files.cdn.thinkific.com/file_uploads/540012/images/59c/6b0/7c5/YBU_CurrDev_Template_1600_x_700.png?width=1920&dpr=3 3x"></p>

	<p>Nice work, the G-Flag was successfully added to this node.</p>

	<h3 id="reflection">Reflection</h3>

	<p>In this lab, you implemented a rolling config change to a cluster on Yugabyte Platform. You also compared different configuration change methods so you can determine which suits a client better.</p>
</div>
